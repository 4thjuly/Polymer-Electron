<link rel="import" href="../lib/polymer/polymer.html">
<link rel="import" href="../lib/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../lib/paper-button/paper-button.html">

<dom-module id="test-app">

  <template>
    <style include="iron-flex">
      :host { --app-primary-color: #4285f4; --app-secondary-color: black; display: block; background-color:lightgray }
      .top-bar { color: #fff; background-color: var(--app-primary-color); }
      .outer { height:100% }
      .middle { background-color: lightsteelblue; text-align: center}
      .status { text-align: right; padding: 0px 10px }
    </style>

    <div class="layout vertical outer">
      <div class="layout horizontal top-bar"><paper-button on-click="handleClick">Test</paper-button></div>
      <image id="image" class="flex middle"></image>
      <div class="status">{{status}}</div>
    </div>
  </template>

  <script>
    class TestApp extends Polymer.Element {
      static get is() { return 'test-app' }

      constructor() {
        super();
        this.status = 'Starting...';
      }

      ready() {
        super.ready();
        this.status = 'Started';
      }

      async handleClick() {
        try {
          let fetch = require('isomorphic-fetch');
          let headers = new Headers();
          headers.append('Authorization', 'Basic' + btoa('test:test'));
          this.status = 'Loading...';
          let resp = await fetch('http://192.168.1.163/dms', {headers: headers});
          if (resp.ok) {
            this.status = 'Loaded';
            let blob = await resp.blob();
            var image = document.getElementById('image');
            var objURL = URL.createObjectURL(blob);
            image.src = objURL;
          } else {
            this.status = 'Error: ' + resp.statusText;
          }
        } catch (error) {
          console.log('ERROR handleClick: ', error);
        }
      }

    }

    customElements.define(TestApp.is, TestApp);
  </script>

</dom-module>
