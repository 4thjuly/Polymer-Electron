<link rel="import" href="../lib/polymer/polymer.html">
<link rel="import" href="../lib/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../lib/paper-button/paper-button.html">

<dom-module id="test-app">

  <template>
    <style include="iron-flex">
      :host { --app-primary-color: #4285f4; --app-secondary-color: black; display: block; background-color:lightgray }
      .top-bar { color: #fff; background-color: var(--app-primary-color); }
      .outer { height:100% }
      .middle { background-color: lightsteelblue; text-align: center}
      .status { text-align: right; padding: 0px 10px }
      .image { width: 100%; height: 100%; object-fit: contain }
    </style>

    <div class="layout vertical outer">
      <div class="layout horizontal top-bar"><paper-button on-click="handleClick">Refresh</paper-button></div>
      <div id="imageGrid1" class="layout vertical flex middle">
        <div class="layout horizontal flex"> 
          <div class="flex">
              <image id="image1" class="image"> </image>
          </div> 
          <div class="flex" style="background-color: red"> Two </div> 
        </div>
        <div class="layout horizontal flex"> 
            <div class="flex"> Three </div>
            <div class="flex"> Four </div> 
        </div>
      </div>
      <!-- <image id="image1" class="flex middle"></image> -->
      <div class="status">{{status}}</div>
    </div>
  </template>

  <script>
    class TestApp extends Polymer.Element {
      static get is() { return 'test-app' }

      constructor() {
        super();
        this.status = 'Starting...';
      }

      ready() {
        super.ready();
        this.status = 'Started';
      }

      async handleClick() {
        try {
          // let fetch = require('isomorphic-fetch');
          let headers = new Headers();
          headers.append('Authorization', 'Basic ' + btoa('test:test'));
          this.status = 'Loading...';
          let resp = await fetch('http://192.168.1.163/dms', {headers: headers});
          // let resp = await fetch('https://facebook.github.io/react-native/docs/assets/favicon.png');
          if (resp.ok) {
            this.status = 'Loaded';
            // const reader = resp.body.getReader();
            // let data = reader.read();
            let blob = await resp.blob();
            var objUrl = URL.createObjectURL(blob);
            // var image = this.getElementById('image1');
            // image.src = objURL;
            this.$.image1.src = objUrl;
          } else {
            this.status = 'Error: ' + resp.statusText;
          }
        } catch (error) {
          console.log('ERROR handleClick: ', error);
        }
      }

    }

    customElements.define(TestApp.is, TestApp);
  </script>

</dom-module>
